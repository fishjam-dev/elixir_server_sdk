services:
  test:
    image: membraneframeworklabs/docker_membrane:v2.2.0
    command: sh -c "cd app/ && mix deps.get && mix coveralls.json --warnings-as-errors"
    volumes:
      - .:/app
      - /app/deps
      - /app/_build
    ports:
      - "4000:4000"
    depends_on:
      fishjam:
        condition: service_healthy

  fishjam:
    extends:
      file: docker-compose-dev.yaml
      service: fishjam
    environment:
      - FJ_HOST=fishjam:5002
      - FJ_COMPONENTS_USED=file hls rtsp sip recording
    volumes:
      - ./test/fixtures:/app/fishjam_resources/file_component_sources
